<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8" />

    <title>Demo Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
    <script>
		var socket =  io.connect('http://localhost:9091');
		let userName// = 'user' + Math.floor(Math.random()*1000)
		console.log('my name is ' + userName)
		let users = {}
		let myId
		socket.on('connect', () => {
			console.log('connected!')
			socket.emit('hello',{/*userName:userName*/})
		});
		socket.on('you', data => {
		    console.log('you', data)
		    myId = data
		    if(users[myId]) {
		        userName = users[myId]
			    console.log('Now my name is ' + userName)
		    }
		});
		socket.on('everybody', data => {
		    users = data
			console.log('everybody', data)
			if(myId) {
			    userName = users[myId]
                console.log('At least my name is ' + userName)
			}
		});
		socket.on('new user', data => {
			console.log('new user: ' + data)
		    users[data[0]] = data[1]
		});
		socket.on('down', data => {
			console.log(data.userName + ': down!')
		});
		socket.on('up', data => {
			console.log(data.userName + ': up!')
		});
		socket.on('disconnected', data => {
		    console.log('disconnected: ' + data)
		})
		addEventListener('keydown', e => {
		    switch (e.code) {
		    case 'ArrowDown':
		    case 'KeyS':
		        socket.emit('down', {userName:userName})
		        break
		    case 'ArrowUp':
		    case 'KeyW':
		        socket.emit('up',{userName:userName})
		    }
		})
    </script>
</head>
<body>
    <button onclick="var jsonObject = {userName: 'userName',
                                          message: 'message'};
                        socket.emit('chatevent', jsonObject);">Send a message</button>
</body>
</html>